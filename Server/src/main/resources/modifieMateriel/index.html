<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Modifier materiel</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://kit.fontawesome.com/02544ac723.js" crossorigin="anonymous"></script>

</head>
<body>
    <div class="div div1">
        <nav>
            <li class="test">
                <a href="/accueil/">Page d'accueil</a>
                <a href="?logout">Déconnexion   <i class="fa-solid fa-arrow-right-from-bracket"></i></a>
            </li>
        </nav>
    </div>
    <div>
        <p><h1>Modifier le materiel</h1></p>
    </div>
    <div id="container">
        <form class="form" method="GET" id="ModifieMateriel" action="UPDATE">
            <label class="label lab1" for="genre">
                Type du materiel <select name="type" id="type" required>
                    <option value="MOBILE">Telephone</option>
                    <option value="LAPTOP">Ordinateur portable</option>
                    <option value="TABLET">Tablette</option>
                    <option value="OTHER">Autre</option>
                </select>
            </label><br />
            <label class="label lab1" for="genre">
                System d'operation <select name="OS" id="OS" required>
                    <option value="AN">Android</option>
                    <option value="AP">Apple</option>
                    <option value="XX">Autre</option>
                </select>
            </label><br />

            <label class="label lab1" for="name">
                Nom de l'appareil <input class="input" type="text" name="nom" id="nom" required><br>
            </label>
            <label class="label lab1">
                Version <input class="input" type="text" name="version" id="version" required><br>
            </label>

            <div>
                <button type="submit" class="connectButt" name="submit" value="registration" id="submit" oneclick="updateMateriel()">
                    Valider
                </button>
            </div>
        </form>
        <div id="popup-frame" hidden>
            <div id="popup">
                <h5 id="popup-title"></h5>
                <button onclick="popupFrame.hidden = true;">Ok</button>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    const popupFrame = document.getElementById('popup-frame');

    function updateMateriel() {
        //TODO
    }

    const urlParams = new URLSearchParams(window.location.search);
    let id = urlParams.get('id');

    function populateData(items) {
        for (let item of items) {
            if (item.id == id) {
                
                dataItem(item);
            }
        }
    }

    function dataItem(item) {    
        document.getElementById('type').value = item.type;
        document.getElementById('OS').value = item.os;
        document.getElementById('nom').value = item.name;
        document.getElementById('version').value = item.version;
    }

    function encodeFormOptions(options = {}) {
        let params = new URLSearchParams();
        for (let key in options) {
            if (options[key] !== null && options[key] !== undefined)
                params.append(key, options[key]);
        }
        return params.toString();
    }
    function fetchItems() {
        let options = {};
        options.includeReserved = true;

        fetch('/api/list_items', {
            method: 'POST',
            body: encodeFormOptions(options),
        }).then((response) => {
            if (response.ok)
                return response.json();
            else
                throw new Error('Could not fetch items');
        }).then((data) => {
            populateData(data.items);
        }).catch((err) => {
            console.error(err);
            popupFrame.hidden = false;
            popupFrame.querySelector('#popup-title').innerText = err.message;
        });
    }

    window.addEventListener('load', () => {
        fetchItems();
    });



    function fetchItemsLater() {
        if (fetchCooldown)
            clearTimeout(fetchCooldown);
        fetchCooldown = setTimeout(() => {
            fetchItems();
        }, 500);
    }

</script>